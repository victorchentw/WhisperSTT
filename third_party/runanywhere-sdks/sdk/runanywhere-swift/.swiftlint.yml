# SwiftLint configuration for RunAnywhere SDK

# Rule configuration
opt_in_rules:
  - attributes
  - closure_end_indentation
  - closure_spacing
  - collection_alignment
  - contains_over_filter_count
  - contains_over_filter_is_empty
  - contains_over_first_not_nil
  - contains_over_range_nil_comparison
  - empty_collection_literal
  - empty_count
  - empty_string
  - first_where
  - force_unwrapping
  - last_where
  - legacy_multiple
  - multiline_arguments
  - multiline_function_chains
  - multiline_parameters
  - operator_usage_whitespace
  - overridden_super_call
  - prefer_self_type_over_type_of_self
  - redundant_nil_coalescing
  - redundant_type_annotation
  - strict_fileprivate
  - toggle_bool
  - unneeded_parentheses_in_closure_argument
  - yoda_condition
  # Strongly typed rules
  - discouraged_object_literal
  - array_init
  # Unused code detection rules (lint-time)
  - unused_closure_parameter
  - unused_control_flow_label
  - unused_enumerated
  - unused_optional_binding
  - unused_setter_value
  - redundant_optional_initialization
  - redundant_set_access_control
  - redundant_void_return
  - redundant_objc_attribute
  - redundant_string_enum_value
  # Code quality rules
  - sorted_imports
  - trailing_semicolon
  - opening_brace
  - closure_parameter_position

# Analyzer rules (require `swiftlint analyze` with compilation)
# Run: swiftlint analyze --compiler-log-path <path-to-xcodebuild-log>
analyzer_rules:
  - unused_import
  - unused_declaration
  - typesafe_array_init

# Disabled rules (too strict or cosmetic)
disabled_rules:
  - explicit_type_interface  # Swift's type inference is a feature
  - implicit_return  # Explicit returns are often clearer
  - discouraged_optional_collection  # Optional collections are valid Swift
  - pattern_matching_keywords  # Too opinionated
  - vertical_whitespace_opening_braces  # Too cosmetic
  - vertical_whitespace_closing_braces  # Too cosmetic
  - trailing_closure  # Explicit closures are often clearer

# Directories to include
included:
  - Sources
  - Tests

# Directories to exclude
excluded:
  - .build
  - DerivedData
  - Package.swift

# Configure individual rules
line_length:
  warning: 150
  error: 200
  ignores_urls: true
  ignores_function_declarations: true
  ignores_comments: true

file_length:
  warning: 800
  error: 1500

function_body_length:
  warning: 80
  error: 300

function_parameter_count:
  warning: 8
  error: 15

type_body_length:
  warning: 400
  error: 600

cyclomatic_complexity:
  warning: 15
  error: 30

large_tuple:
  warning: 3
  error: 5

identifier_name:
  min_length:
    warning: 2
    error: 1
  max_length:
    warning: 40
    error: 50
  excluded:
    - id
    - i
    - j
    - k
    - x
    - y
    - z

type_name:
  min_length: 3
  max_length:
    warning: 40
    error: 50

# Custom configurations
force_cast: error
force_try: error
trailing_whitespace:
  ignores_empty_lines: true
vertical_whitespace:
  max_empty_lines: 2

# Additional rule configuration
redundant_string_enum_value:
  severity: warning

# Custom rules for strong typing
custom_rules:
  avoid_any_type:
    name: "Avoid Any Type"
    regex: ':\s*Any\b'
    message: "Avoid using 'Any' type. Use specific types or protocols instead."
    severity: warning

  avoid_any_object:
    name: "Avoid AnyObject Type"
    regex: ':\s*AnyObject\b'
    message: "Avoid using 'AnyObject' type. Use specific types or protocols instead."
    severity: warning

  prefer_concrete_types:
    name: "Prefer Concrete Types"
    regex: ':\s*\[String:\s*Any\]'
    message: "Avoid dictionaries with 'Any' values. Define a struct or use specific types."
    severity: warning

  avoid_force_cast:
    name: "Avoid Force Cast"
    regex: ' as! '
    message: "Force casting can crash. Use conditional casting (as?) instead."
    severity: error

  avoid_implicitly_unwrapped_optionals:
    name: "Avoid Implicitly Unwrapped Optionals"
    regex: ':\s*\w+!'
    message: "Avoid implicitly unwrapped optionals. Use regular optionals or non-optional types."
    severity: warning

  todo_with_issue:
    name: "TODO Must Reference GitHub Issue"
    regex: '//\s*(TODO|FIXME|HACK|XXX|BUG|REFACTOR|OPTIMIZE)(?!.*#\d+)'
    message: "TODOs must reference a GitHub issue (e.g., // TODO: #123 - Description)"
    severity: warning

  multiline_todo_with_issue:
    name: "Multiline TODO Must Reference GitHub Issue"
    regex: '/\*\s*(TODO|FIXME|HACK|XXX|BUG|REFACTOR|OPTIMIZE)(?!.*#\d+)'
    message: "TODOs must reference a GitHub issue (e.g., /* TODO: #123 - Description */)"
    severity: warning

  # Logging enforcement rules - require SDKLogger usage
  # Note: SDKLogger.swift is the only file allowed to use print() as it's the console output mechanism.
  # Use "// swiftlint:disable:next no_print_statements" above intentional print() usage.
  no_print_statements:
    name: "Use SDKLogger Instead of print()"
    regex: '^\s*print\('
    message: "Use SDKLogger instead of print(). Example: SDKLogger.shared.debug(\"message\")"
    severity: error

  no_nslog_statements:
    name: "Use SDKLogger Instead of NSLog()"
    regex: 'NSLog\('
    message: "Use SDKLogger instead of NSLog(). Example: SDKLogger.shared.info(\"message\")"
    severity: error

  no_os_log_statements:
    name: "Use SDKLogger Instead of os_log()"
    regex: 'os_log\('
    message: "Use SDKLogger instead of os_log(). The SDK logging system handles os_log internally."
    severity: error

  no_debug_print_statements:
    name: "Use SDKLogger Instead of debugPrint()"
    regex: 'debugPrint\('
    message: "Use SDKLogger.debug() instead of debugPrint(). Example: SDKLogger.shared.debug(\"message\")"
    severity: error

  no_apple_logger:
    name: "Use SDKLogger Instead of Apple Logger"
    regex: '= Logger\('
    message: "Use SDKLogger instead of Apple's os.Logger. Example: SDKLogger(category: \"MyCategory\")"
    severity: error
